# 2023-11-09 卡片详情修复（第四版）

## 问题描述
根据调试日志，发现卡片信息映射没有正确加载，导致类型、种族和属性数组都是空的，无法匹配到正确的文本。具体问题如下：

1. 在解析 cardinfo_chinese.txt 文件时，有几行被标记为"格式不正确"
2. 特别是在 link marker 部分，有些行只有一个值（如 "0x40"），没有第二个值，导致它们被跳过
3. 文件中可能存在不同的行结束符（\r\n, \r, \n）导致解析不一致

## 修复内容

### 1. 改进文件内容预处理
- 添加了行结束符统一处理：`$content = str_replace(["\r\n", "\r"], "\n", $content);`
- 确保所有行都使用相同的换行符格式

### 2. 改进数据行解析逻辑
- 首先尝试使用制表符分隔：`$parts = explode("\t", $line);`
- 如果没有成功分隔（只有一个元素），尝试使用正则表达式匹配十六进制数和后面的内容
- 如果仍然没有成功分隔，但是是一个有效的十六进制数，则将其作为代码，名称设为空字符串
- 明确跳过不需要的节（link marker 和 category）

### 3. 放宽数据行要求
- 允许只有一个值的行（代码值）被处理，将名称设为空字符串
- 这样可以确保所有有效的代码都被加载到相应的映射中

## 技术说明
- 文件格式问题是导致卡片信息映射加载失败的主要原因
- 通过更灵活的解析逻辑，我们可以处理各种格式的行，确保所有有效的代码都被加载
- 跳过不需要的节（如 link marker 和 category）可以避免不必要的处理
- 调试日志显示类型、种族和属性数组都是空的，这就是为什么无法匹配到正确的文本
