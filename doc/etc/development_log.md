# 开发日志

## 2023年11月

### 2023-11-09 卡片功能和修复
- 实现了卡片详情页面，显示卡片的完整信息
- 修复了卡片类型、种族和属性的显示问题
- 添加了卡片图片显示功能，支持从服务器获取卡图
- 优化了卡片搜索功能，支持按ID和名称搜索
- 修复了strpos()函数参数类型问题，确保在PHP 7.4及以上版本中不会出现废弃警告

### 2023-11-09 卡片分页功能
- 实现了卡片列表的分页功能
- 支持自定义每页显示的卡片数量（10/20/50/100）
- 添加了分页导航，方便用户浏览大量卡片

### 2023-11-15 系统修复
- 修复了界面上的大部分链接点击后出现HTTP 404的问题
- 修复了页面布局问题，使页脚始终显示在页面底部
- 修改了卡片解析器中的图片路径处理逻辑，同时支持"c+卡片ID"和"卡片ID"两种格式
- 修改了卡片列表和搜索页面，只显示ID和卡名，移除了类型信息

### 2023-11-22 系统初始化
- 创建了基本的目录结构
- 实现了MVC架构
- 生成了初始代码和视图模板
- 配置了系统环境和参数

### 2023-11-23 布局优化
- 优化了整体页面布局
- 改进了导航栏和页脚设计
- 更新了README文档

## 2023年12月

### 2023-12-01 作者管理功能实现
- 实现了作者管理功能，允许管理员（等级2以上）管理卡片作者信息
- 创建了author_mappings表，用于存储作者映射信息
- 创建了AuthorMapping模型类，提供作者映射相关方法
- 在AdminController中添加了作者管理相关方法
- 创建了作者管理相关视图文件
- 修改了作者识别逻辑，调整了作者识别的优先级

### 2023-12-02 作者编辑功能
- 实现了作者信息编辑功能，允许管理员编辑已有的作者信息
- 添加了编辑作者页面，包含卡片前缀、作者名称、作者别名、联系方式和备注字段
- 实现了编辑作者的控制器方法
- 添加了表单验证和成功/错误消息提示

### 2023-12-03 作者前缀编辑功能
- 实现了作者前缀编辑功能，允许管理员修改卡片前缀
- 在编辑作者页面中添加了修改卡片前缀的功能
- 添加了卡片前缀验证，确保前缀是有效的数字
- 实现了更新卡片前缀的控制器方法
- 添加了唯一性检查，确保不会与现有前缀冲突

### 2023-12-04 作者光荣榜优先级更新
- 修改了作者光荣榜的排序逻辑，优先按投稿卡片数量从高到低排序
- 同等卡片数量的作者按禁卡比例从高到低排序
- 将未知作者放在最后显示
- 当作者字段为空且不是"未知作者"时，使用卡片ID的前三位数字

### 2023-12-05 作者光荣榜禁卡表优化
- 在计算禁卡比例时，排除了"#Forbidden TCG"下的卡片，因为这些不是服务器作者创建的
- 优化了禁卡表解析逻辑，提高性能
- 修复了作者光荣榜计算中的错误，确保数据准确性

### 2023-12-06 卡片数据库排除和作者简化模式
- 在config.php中添加了设置，用于排除特定文件（默认：Pre_Nerf_cards.cdb和SoundStageLib.cdb）
- 修改了卡片解析器，使其在加载卡片数据时排除这些文件
- 在config.php中添加了简化作者识别模式选项，该模式下只使用管理员管理的作者列表进行识别（默认：false）
- 优化了卡片数据加载性能，避免加载不必要的数据

### 2023-12-07 作者光荣榜计算修复
- 修复了作者光荣榜计算中的错误，确保数据准确性
- 优化了大量数据的处理性能
- 修改了排序逻辑，优先按投稿卡片数量从高到低排序
- 将未知作者和ID前缀作者放在已知作者之后显示

### 2023-12-08 作者识别正则表达式修复
- 修改了作者识别的正则表达式，以更好地匹配各种分隔符
- 新的正则表达式支持多种格式，包括使用不同分隔符和"by"关键字的情况
- 在匹配到作者名后，添加了额外的清理步骤
- 使用preg_replace移除作者名开头可能存在的分隔符
- 使用trim移除作者名两端的空白字符

### 2023-12-09 作者名称特殊字符处理修复
- 修复了作者名称中包含特殊字符（如日文假名、全角符号等）时无法正确识别的问题
- 添加了对特殊字符的检测：使用/[^\x00-\x7F]/正则表达式检测作者名是否包含非ASCII字符
- 对于包含特殊字符的作者名，不进行单词截断处理，保留完整的作者名
- 只对纯英文名称（只包含英文字母、数字和基本标点）进行单词截断处理
- 保留了对方括号等标记的处理，确保作者名不包含不必要的标记

## 2024年7月（计划）

### 2024-07-09 禁卡表管理实现
- 实现禁卡表管理功能
- 添加投票结果统计和分析
- 支持生成lflist.conf格式的禁卡表
- 添加管理员界面，方便管理禁卡表

### 2024-07-10 作者光荣榜功能
- 实现作者光荣榜功能
- 显示所有作者的卡片数量和禁卡比例
- 按禁卡比例排序，高亮显示禁卡比例高的作者
- 统计每位作者的被禁系列数量

### 2024-07-11 作者名称规范化
- 实现作者名称规范化功能
- 处理各种格式的作者信息
- 移除常见的附加文本（如"图侵删歉"）
- 优化英文作者名的处理逻辑

### 2024-07-12 空作者名修复
- 修复作者名为空的问题
- 确保作者名称规范化函数不会返回空字符串
- 增强作者提取逻辑
- 优化作者光荣榜的显示效果

### 2024-07-13 作者检测逻辑优化
- 移除从卡名中提取作者信息的逻辑
- 增强从strings.conf文件中解析作者信息的能力
- 改进卡片ID与作者匹配的逻辑
- 增加使用卡片ID前三位进行匹配的功能

### 2024-07-15 作者光荣榜调试功能
- 实现了作者光荣榜调试功能，允许管理员生成详细的作者禁卡信息
- 在DEBUG_MODE=true时，为管理员提供"生成调试内容"按钮
- 生成带有时间戳的调试文件夹，包含每个作者的禁卡详情
- 修复了文件名和内容的编码问题，确保正确处理中文和特殊字符
- 优化了作者名称的编码处理，解决了榜单中的空行问题
- 添加了详细的文档，记录功能实现和编码问题修复
