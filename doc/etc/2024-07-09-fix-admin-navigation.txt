# 2024-07-09 修复管理员导航栏问题

## 问题描述
在管理员登录后，导航栏中没有显示禁卡表管理的入口。虽然在layout.php中已经添加了相关代码，
但由于依赖于控制器传递的userModel变量，导致在某些情况下无法正确显示管理员功能链接。

## 原因分析
问题出现在layout.php中对用户登录状态的检查方式：

1. 原代码依赖于控制器传递的$userModel变量来检查用户是否登录：
   ```php
   <?php if (isset($userModel) && $userModel->isLoggedIn()): ?>
   ```

2. 在某些情况下，$userModel变量可能没有被正确传递或初始化，导致即使用户已登录，
   管理员功能链接也不会显示。

## 修复方案
修改layout.php，直接使用Auth类来检查用户登录状态，而不依赖于控制器传递的变量：

1. 在layout.php的开头直接获取Auth实例并检查登录状态
2. 重新组织导航栏，使管理员功能链接更加突出
3. 将管理员登录链接与退出登录链接分开显示，使界面更加清晰

## 修改内容

### layout.php
1. 添加了直接获取Auth实例的代码：
   ```php
   // 直接获取Auth实例，检查登录状态
   $auth = Auth::getInstance();
   $isLoggedIn = $auth->isLoggedIn();
   ```

2. 修改了导航栏的结构，使用$auth变量而不是$userModel：
   ```php
   <?php if ($isLoggedIn): ?>
       <!-- 管理员功能链接 -->
       <?php if ($auth->hasPermission(1)): ?>
           <li><a href="<?php echo BASE_URL; ?>?controller=admin&action=votes">投票管理</a></li>
           <li><a href="<?php echo BASE_URL; ?>?controller=admin&action=banlist">禁卡表整理</a></li>
       <?php endif; ?>
       
       <!-- 用户信息和登出链接 -->
       <li class="user-info">
           <span><?php echo $auth->getCurrentUsername(); ?> (<?php 
               // 用户组名称显示
           ?>)</span>
       </li>
       <li><a href="<?php echo BASE_URL; ?>?controller=admin&action=logout">退出登录</a></li>
   <?php else: ?>
       <!-- 管理员登录链接 -->
       <li><a href="<?php echo BASE_URL; ?>?controller=admin&action=login">管理员登录</a></li>
   <?php endif; ?>
   ```

3. 将用户组名称的获取逻辑直接内嵌在layout.php中，不再依赖于User模型：
   ```php
   $group = $auth->getCurrentGroup();
   switch ($group) {
       case 1: echo '编辑员'; break;
       case 2: echo '管理员'; break;
       case 3: echo '高级管理员'; break;
       case 255: echo '超级管理员'; break;
       default: echo '未知'; break;
   }
   ```

## 修复结果
修复后，只要用户成功登录，导航栏就会始终显示相应的管理员功能链接，包括投票管理和禁卡表整理。
同时，退出登录链接也会单独显示，使界面更加清晰。
